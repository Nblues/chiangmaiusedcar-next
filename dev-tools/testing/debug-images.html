<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</title>
    <style>
      body {
        font-family: 'Prompt', sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .test-section {
        border: 2px solid #ddd;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
      }
      button {
        background: #1a237e;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      .result {
        background: #f5f5f5;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        font-family: monospace;
        font-size: 12px;
      }
      img {
        max-width: 300px;
        height: auto;
        border: 2px solid #ddd;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>üß™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û - Debug Tool</h1>

    <div class="test-section">
      <h2>1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h2>
      <button onclick="createTestImage()">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
      <button onclick="uploadToLocalStorage()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage</button>
      <div id="test-image-result"></div>
    </div>

    <div class="test-section">
      <h2>2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage</h2>
      <button onclick="checkLocalStorage()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage</button>
      <button onclick="listAllImages()">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
      <div id="storage-result"></div>
    </div>

    <div class="test-section">
      <h2>3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h2>
      <button onclick="displayStoredImages()">‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å localStorage</button>
      <div id="display-result"></div>
    </div>

    <div class="test-section">
      <h2>4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö HTML IMG Tag</h2>
      <button onclick="testImageTags()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö IMG Tags</button>
      <div id="html-result"></div>
    </div>

    <script>
      let testImageData = null;
      let testImageName = null;

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏î‡∏™‡∏≠‡∏ö
      function createTestImage() {
        const canvas = document.createElement('canvas');
        canvas.width = 400;
        canvas.height = 300;
        const ctx = canvas.getContext('2d');

        // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
        ctx.fillStyle = '#1a237e';
        ctx.fillRect(0, 0, 400, 300);

        // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        ctx.fillStyle = 'white';
        ctx.font = 'bold 24px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('Test Image', 200, 150);
        ctx.font = '16px Arial';
        ctx.fillText(new Date().toISOString(), 200, 180);

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        const result = document.getElementById('test-image-result');
        result.innerHTML = '<h3>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:</h3>';
        result.appendChild(canvas);

        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        testImageData = canvas.toDataURL('image/png');
        testImageName = `test_${Date.now()}.png`;

        result.innerHTML += `<div class="result">
                Image Data Length: ${testImageData.length} characters<br>
                Image Name: ${testImageName}<br>
                Data Preview: ${testImageData.substring(0, 50)}...
            </div>`;
      }

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
      function uploadToLocalStorage() {
        if (!testImageData) {
          alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô!');
          return;
        }

        try {
          // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö saveImageToStorage
          const articleId = 'test';
          const imageName = `${articleId}_${Date.now()}_test.png`;

          const images = JSON.parse(localStorage.getItem('article_images') || '{}');
          images[imageName] = {
            data: testImageData,
            name: 'test.png',
            size: testImageData.length,
            type: 'image/png',
            uploadDate: new Date().toISOString(),
          };

          localStorage.setItem('article_images', JSON.stringify(images));

          document.getElementById('test-image-result').innerHTML += `
                    <div class="result" style="background: #d4edda;">
                        ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!<br>
                        Image Key: ${imageName}<br>
                        Total Images in Storage: ${Object.keys(images).length}
                    </div>`;
        } catch (error) {
          document.getElementById('test-image-result').innerHTML += `
                    <div class="result" style="background: #f8d7da;">
                        ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}
                    </div>`;
        }
      }

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage
      function checkLocalStorage() {
        try {
          const images = JSON.parse(localStorage.getItem('article_images') || '{}');
          const result = document.getElementById('storage-result');

          result.innerHTML = `<div class="result">
                    localStorage Size: ${JSON.stringify(images).length} characters<br>
                    Number of Images: ${Object.keys(images).length}<br>
                    Keys: ${Object.keys(images).join(', ')}<br>
                    <br>
                    Raw Data:<br>
                    <textarea style="width:100%; height:100px; font-size:10px;">${JSON.stringify(images, null, 2)}</textarea>
                </div>`;
        } catch (error) {
          document.getElementById('storage-result').innerHTML = `
                    <div class="result" style="background: #f8d7da;">
                        ‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô localStorage: ${error.message}
                    </div>`;
        }
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
      function listAllImages() {
        try {
          const images = JSON.parse(localStorage.getItem('article_images') || '{}');
          const result = document.getElementById('storage-result');

          let html = '<h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</h3>';

          if (Object.keys(images).length === 0) {
            html += '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô localStorage</p>';
          } else {
            Object.keys(images).forEach(key => {
              const img = images[key];
              html += `<div class="result">
                            <strong>Key:</strong> ${key}<br>
                            <strong>Name:</strong> ${img.name}<br>
                            <strong>Size:</strong> ${img.size} bytes<br>
                            <strong>Type:</strong> ${img.type}<br>
                            <strong>Upload Date:</strong> ${img.uploadDate}<br>
                            <strong>Data Length:</strong> ${img.data ? img.data.length : 'No data'} characters<br>
                        </div>`;
            });
          }

          result.innerHTML += html;
        } catch (error) {
          document.getElementById('storage-result').innerHTML += `
                    <div class="result" style="background: #f8d7da;">
                        ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}
                    </div>`;
        }
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å localStorage
      function displayStoredImages() {
        try {
          const images = JSON.parse(localStorage.getItem('article_images') || '{}');
          const result = document.getElementById('display-result');

          result.innerHTML = '<h3>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å localStorage:</h3>';

          if (Object.keys(images).length === 0) {
            result.innerHTML += '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô localStorage</p>';
            return;
          }

          Object.keys(images).forEach(key => {
            const img = images[key];
            if (img.data) {
              const imgElement = document.createElement('img');
              imgElement.src = img.data;
              imgElement.alt = img.name;
              imgElement.title = `${img.name} (${key})`;
              result.appendChild(imgElement);

              result.innerHTML += `<div class="result">
                            Image: ${img.name}<br>
                            Key: ${key}<br>
                            Status: ${imgElement.complete ? '‚úÖ Loaded' : '‚è≥ Loading...'}
                        </div>`;
            }
          });
        } catch (error) {
          document.getElementById('display-result').innerHTML = `
                    <div class="result" style="background: #f8d7da;">
                        ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}
                    </div>`;
        }
      }

      // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö HTML IMG Tags
      function testImageTags() {
        try {
          const images = JSON.parse(localStorage.getItem('article_images') || '{}');
          const result = document.getElementById('html-result');

          result.innerHTML = '<h3>‡∏ó‡∏î‡∏™‡∏≠‡∏ö HTML IMG Tags:</h3>';

          if (Object.keys(images).length === 0) {
            result.innerHTML += '<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô</p>';
            return;
          }

          // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà RichTextEditor ‡∏™‡∏£‡πâ‡∏≤‡∏á
          Object.keys(images).forEach(key => {
            const img = images[key];

            // HTML ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á
            const htmlTag = `<img src="${img.data}" alt="${img.name}" style="max-width: 100%; height: auto; margin: 10px 0;" />`;

            result.innerHTML += `<div class="result">
                        <strong>Generated HTML:</strong><br>
                        <textarea style="width:100%; height:60px; font-size:10px;">${htmlTag}</textarea><br>
                        <strong>Rendered Result:</strong><br>
                        <div style="border: 1px solid #ccc; padding: 10px; background: white;">
                            ${htmlTag}
                        </div>
                    </div>`;
          });
        } catch (error) {
          document.getElementById('html-result').innerHTML = `
                    <div class="result" style="background: #f8d7da;">
                        ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}
                    </div>`;
        }
      }

      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      window.onload = function () {
        checkLocalStorage();
      };
    </script>
  </body>
</html>
