# Security headers and admin protection

<IfModule mod_headers.c>
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "accelerometer=(), camera=(), geolocation=(), microphone=(), payment=()"
    
    # Remove server signature
    Header unset Server
    Header unset X-Powered-By
</IfModule>

# Block access to admin routes via HTTP

<Files "admin\*">
Order Deny,Allow
Deny from all # Allow only specific IP addresses (uncomment and add your IPs) # Allow from 127.0.0.1 # Allow from YOUR_IP_ADDRESS
</Files>

# Block access to sensitive files

<FilesMatch "\.(env|log|sql|sqlite|db)$">
Order Allow,Deny
Deny from all
</FilesMatch>

# Block access to development files

<FilesMatch "\.(bak|backup|old|tmp|temp|test)$">
Order Allow,Deny
Deny from all
</FilesMatch>

# Disable directory browsing

Options -Indexes

# Block bot access to admin areas

RewriteEngine On

# Block known AI bots from admin areas

RewriteCond %{HTTP_USER_AGENT} (ChatGPT|Claude|anthropic|CCBot|AI2Bot|OpenAI) [NC]
RewriteRule ^admin.\* - [F,L]

# Block direct access to admin without proper referrer

RewriteCond %{REQUEST_URI} ^/admin._
RewriteCond %{HTTP_REFERER} !^https://chiangmaiusedcar\.com._$ [NC]
RewriteCond %{HTTP_REFERER} !^http://localhost.*$ [NC]
RewriteRule .\* - [F,L]

# Rate limiting for admin access (if mod_evasive is available)

<IfModule mod_evasive24.c>
    DOSHashTableSize    2048
    DOSPageCount        3
    DOSPageInterval     10
    DOSSiteCount        100
    DOSSiteInterval     10
    DOSBlockingPeriod   600
</IfModule>
