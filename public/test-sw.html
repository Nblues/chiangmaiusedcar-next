<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Service Worker Test - ‡∏Ñ‡∏£‡∏π‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏ñ‡∏™‡∏ß‡∏¢</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .status {
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        font-weight: bold;
      }
      .success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      .warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
      }
      button {
        background: #1a237e;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #303f9f;
      }
      .log {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Service Worker Test Center</h1>
      <p>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö Service Worker ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏Ñ‡∏£‡∏π‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏£‡∏ñ‡∏™‡∏ß‡∏¢</p>

      <div id="swStatus" class="status info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Service Worker...</div>

      <div>
        <button onclick="testServiceWorker()">üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Service Worker</button>
        <button onclick="registerServiceWorker()">üìã ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker</button>
        <button onclick="unregisterServiceWorker()">üóëÔ∏è ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
        <button onclick="updateServiceWorker()">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Service Worker</button>
        <button onclick="clearLogs()">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>

      <h3>üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Service Worker</h3>
      <div id="swInfo" class="log">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>

      <h3>üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
      <div id="logs" class="log">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...</div>
    </div>

    <script>
      const logsElement = document.getElementById('logs');
      const swStatusElement = document.getElementById('swStatus');
      const swInfoElement = document.getElementById('swInfo');

      function log(message, type = 'info') {
        const timestamp = new Date().toLocaleTimeString('th-TH');
        const logEntry = `[${timestamp}] ${message}`;
        logsElement.innerHTML += logEntry + '\n';
        logsElement.scrollTop = logsElement.scrollHeight;
        console.log(logEntry);
      }

      function updateStatus(message, type = 'info') {
        swStatusElement.textContent = message;
        swStatusElement.className = `status ${type}`;
      }

      function updateInfo(info) {
        swInfoElement.innerHTML = JSON.stringify(info, null, 2);
      }

      async function testServiceWorker() {
        log('üîç ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö Service Worker...');

        if (!('serviceWorker' in navigator)) {
          updateStatus('‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Service Worker', 'error');
          log('‚ùå Navigator.serviceWorker ‡πÑ‡∏°‡πà‡∏°‡∏µ');
          return;
        }

        log('‚úÖ ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Service Worker');

        try {
          const registration = await navigator.serviceWorker.getRegistration('/');

          if (registration) {
            updateStatus('‚úÖ Service Worker ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß', 'success');
            log('‚úÖ Service Worker ‡∏ñ‡∏π‡∏Å‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß');

            const info = {
              scope: registration.scope,
              state: registration.active ? registration.active.state : '‡πÑ‡∏°‡πà‡∏°‡∏µ active worker',
              installing: !!registration.installing,
              waiting: !!registration.waiting,
              active: !!registration.active,
              updateViaCache: registration.updateViaCache,
            };

            updateInfo(info);
            log(`üìä Scope: ${info.scope}`);
            log(`üìä State: ${info.state}`);
          } else {
            updateStatus('‚ö†Ô∏è Service Worker ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô', 'warning');
            log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker');
          }
        } catch (error) {
          updateStatus('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö', 'error');
          log(`‚ùå Error: ${error.message}`);
        }
      }

      async function registerServiceWorker() {
        log('üìã ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker...');

        if (!('serviceWorker' in navigator)) {
          updateStatus('‚ùå ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Service Worker', 'error');
          return;
        }

        try {
          // Determine which service worker to use
          const isDev = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
          const swFile = isDev ? '/sw-dev.js' : '/sw.js';

          log(`üîß ‡πÉ‡∏ä‡πâ Service Worker: ${swFile}`);

          const registration = await navigator.serviceWorker.register(swFile, {
            scope: '/',
          });

          updateStatus('‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
          log('‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
          log(`üìç Scope: ${registration.scope}`);

          // Listen for updates
          registration.addEventListener('updatefound', () => {
            log('üîÑ ‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Service Worker');
            const newWorker = registration.installing;

            if (newWorker) {
              newWorker.addEventListener('statechange', () => {
                log(`üîÑ Service Worker state: ${newWorker.state}`);
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  log('‚ú® Service Worker ‡πÉ‡∏´‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                }
              });
            }
          });

          await testServiceWorker();
        } catch (error) {
          updateStatus('‚ùå ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
          log(`‚ùå Registration failed: ${error.message}`);
        }
      }

      async function unregisterServiceWorker() {
        log('üóëÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker...');

        try {
          const registration = await navigator.serviceWorker.getRegistration('/');

          if (registration) {
            await registration.unregister();
            updateStatus('‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            log('‚úÖ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            updateInfo({});
          } else {
            updateStatus('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Service Worker ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô', 'warning');
            log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Service Worker ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô');
          }
        } catch (error) {
          updateStatus('‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
          log(`‚ùå Unregistration failed: ${error.message}`);
        }
      }

      async function updateServiceWorker() {
        log('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Service Worker...');

        try {
          const registration = await navigator.serviceWorker.getRegistration('/');

          if (registration) {
            await registration.update();
            log('‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Service Worker ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            await testServiceWorker();
          } else {
            updateStatus('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Service Worker ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô', 'warning');
            log('‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö Service Worker ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï');
          }
        } catch (error) {
          updateStatus('‚ùå ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Service Worker ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', 'error');
          log(`‚ùå Update failed: ${error.message}`);
        }
      }

      function clearLogs() {
        logsElement.innerHTML = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß...\n';
        log('üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
      }

      // Auto-test on page load
      window.addEventListener('load', () => {
        log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô Service Worker Test Center');
        setTimeout(testServiceWorker, 1000);
      });
    </script>
  </body>
</html>
